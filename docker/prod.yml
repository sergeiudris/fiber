version: "3.2"

services:

  db:
    image: seeris/fiber.db:dev
    volumes:
      - type: volume
        source:  fiber.db
        target: /opt/datomic-data
        volume:
          nocopy: true
    command: ./bin/transactor ./config/free-transactor.properties

  app:
    image: seeris/fiber.app:dev
    build:
      context: ../src/stage1/app
      dockerfile: ./prod.Dockerfile
    ports:
      - 4500:8080
      - 4554:7878
    command: bash c main
    links:
      - db:db
    deploy:
      resources:
        limits:
          cpus: '4'
          memory: 4096M
  ui:
    image: seeris/fiber.ui:dev
    build:
      context: ../src/stage1/ui
      dockerfile: ./prod.Dockerfile
    ports:
      - 4664:7888
      - 4600:9500
      - 9630:9630
    command: bash c main
    deploy:
      resources:
        limits:
          cpus: '4'
          memory: 4096M
volumes:
  fiber.db:
